# Kafka 设计文档 中文翻译

1 动机

我们设计 Kafka 的初衷是希望它能处理大型公司实时数据的统一平台。为此我们想过了非常多的用户场景。

它需要高吞吐来支持大量的事件流例如实时的日志聚合。

它需要优雅地处理大量数据积压来支持离线系统周期性的数据加载。

同时它还需要具备低延迟的特性来应对传统的消息队列场景。

我们想要支持可分区，分布式的，实时处理新生成的消息，这促使了我们的分区和消费模型。

最终数据将会流向其他数据系统，该系统需要确保对硬件错误的容错。

对于上述场景的支持使我们的设计更加独特，比起传统的消息系统，kafka 更像是一个数据库。下面的章节我们会勾勒一些 kafka 的设计要素。

2 持久化

**不要害怕文件系统!**

Kafka 在缓存和存储消息上对文件系统有很强的依赖，现在外界总有一种声音说磁盘很慢，这让人们怀疑持久化设备是否能提供有竞争力的性能。事实上，磁盘可以比人们想象的快，也可以比人们想象的慢，这取决于如何使用。经过良好设计的磁盘结构和网络是一样快的。

磁盘性能的关键因素在于硬盘的吞吐在过去的十年里因为磁盘的 seek 操作而分化。在六块 7200rpm SATA RAID-5  的磁盘上的顺序写性能达到了600MB/s，但是随机写的性能只有 100k/s， 差了将近6000倍。顺序读写是所有的使用场景中是最常见的，并且被操作系统重度优化过。现代操作系统提供了 read ahead 和 write ahead 的技术，从app

3 效率
我们在性能上花了非常多力气。其中我们有一个主要场景是处理 web 的活跃数据，数据量非常大：每次访问一个页面都可能会产生数十次写操作。不仅如此，我们假设每条信息被至少一个消费者所用，所以我们努力使性能尽可能要好。
之前我们讨论了磁盘效率的问题，一旦糟糕的磁盘访问方式被限制之后，在这种类型的系统里只有两个会影响效率的因素：太多小型的 I/O 操作，以及过多的拷贝。

4 The Producer(生产者)

5 The Consumer(消费者)

6 消息传送原则/语义

7 数据冗余(Replica)

8 日志压缩(Log Compaction)

9 配额(Quota)